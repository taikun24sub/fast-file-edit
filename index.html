<!DOCTYPE html>
<html>
<head>
    <title>Fast File Edit</title>
</head>
<body>
    <button id="input-file" type="file" onclick='slc();'>Select File</button>
    <button onclick='read();'>Read</button><button onclick='fwrite();'>Write</button>
    <p>v1.1.0f</p>
    <textarea id='inp' style='width:100vw;height:90vh;'></textarea>
    <script>
        const inp = document.getElementById('inp');
        let handler;
        async function slc(){
            handler = await showOpenFilePicker();
        }
        document.addEventListener('dragover', event => {
    event.preventDefault();
    event.dataTransfer.dropEffect = 'copy'; // ドロップ効果を明示的に指定
});

document.addEventListener('drop', async (event) => {
    event.preventDefault();

    const files = Array.from(event.dataTransfer.items);
    if (files.length > 0) {
        handler = await files[0].getAsFileSystemHandle(); // 最初のファイルを使用
        read();
        alert('Loaded!');
    }
});
        function read() {
            try {
                const reader = new FileReader();
                reader.onload = () => {
                    inp.value = reader.result;
                };
                reader.readAsText(handler.getFile());
            } catch (e) {
                inp.value = `Error reading file: ${e.message}`;
            }
        }

        async function fwrite() {
            try {
                let writableStream = await handler.createWritable()
                await writableStream.write(inp.value)
                await writableStream.close()
            } catch (e) {
                inp.value = `Error writing file: ${e.message}`;
            }
        }
    </script>
</body>
</html>
